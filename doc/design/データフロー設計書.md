# „ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™ - „Éá„Éº„Çø„Éï„É≠„ÉºË®≠Ë®àÊõ∏

„Åì„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„Åß„ÅØ„ÄÅ„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å´„Åä„Åë„ÇãÊßò„ÄÖ„Å™„Éá„Éº„Çø„Éï„É≠„Éº„ÇíË©≥Á¥∞„Å´Ë™¨Êòé„Åó„ÄÅMermaid„Çí‰ΩøÁî®„Åó„Å¶Ë¶ñË¶öÂåñ„Åó„Åæ„Åô„ÄÇ

## 1. Âü∫Êú¨„Éá„Éº„Çø„Éï„É≠„ÉºÊ¶ÇË¶Å

### 1.1 „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Éï„É≠„Éº

```mermaid
flowchart TB
    subgraph "Frontend Layer"
        A[React Components] --> B[GraphQL Client<br/>Apollo Client]
        B --> C[State Management<br/>Local State + Cache]
    end
    
    subgraph "Network Layer"
        C --> D[HTTP/WebSocket<br/>GraphQL over HTTPS]
        D --> E[CDN/CloudFront<br/>Edge Caching]
    end
    
    subgraph "API Gateway Layer"
        E --> F[AWS AppSync<br/>GraphQL API]
        F --> G[Schema Validation<br/>Query Parsing]
        G --> H[Authentication<br/>JWT Token Validation]
    end
    
    subgraph "Business Logic Layer"
        H --> I[JavaScript Resolvers<br/>Business Rules]
        I --> J[Data Transformation<br/>Request/Response Mapping]
    end
    
    subgraph "Data Access Layer"
        J --> K[DynamoDB Client<br/>SDK Operations]
        K --> L[Database Operations<br/>Query/Scan/Put/Update]
    end
    
    subgraph "Storage Layer"
        L --> M[DynamoDB Tables<br/>Room + Message]
        M --> N[Indexes<br/>GSI for Query Optimization]
        N --> O[Streams<br/>Change Data Capture]
    end
    
    subgraph "Real-time Layer"
        O --> P[Event Processing<br/>Lambda Triggers]
        P --> Q[WebSocket Connections<br/>Subscription Management]
        Q --> A
    end
```

## 2. Ë™çË®º„ÉªË™çÂèØ„Éï„É≠„ÉºË©≥Á¥∞

### 2.1 Êñ∞Ë¶è„É¶„Éº„Ç∂„ÉºÁôªÈå≤„Éï„É≠„Éº

```mermaid
sequenceDiagram
    actor User as üë§ „É¶„Éº„Ç∂„Éº
    participant UI as üñ•Ô∏è React UI
    participant Apollo as üöÄ Apollo Client
    participant Cognito as üîê Cognito User Pool
    participant AppSync as ‚ö° AWS AppSync
    participant Validation as ‚úÖ Input Validator
    participant Profile as üë• User Profile Service
    
    User->>UI: „Éï„Ç©„Éº„É†ÂÖ•ÂäõÔºàemail, password, usernameÔºâ
    UI->>Validation: ÂÖ•ÂäõÂÄ§Ê§úË®º
    
    alt ÂÖ•ÂäõÂÄ§„ÅåÊúâÂäπ
        Validation-->>UI: Ê§úË®ºÊàêÂäü
        UI->>Apollo: signUp mutationÂÆüË°å
        Apollo->>Cognito: createUser APIÂëº„Å≥Âá∫„Åó
        
        alt „É¶„Éº„Ç∂„Éº‰ΩúÊàêÊàêÂäü
            Cognito-->>Apollo: Á¢∫Ë™ç„Ç≥„Éº„ÉâÈÄÅ‰ø°
            Apollo-->>UI: Á¢∫Ë™ç„Éï„Ç©„Éº„É†Ë°®Á§∫Ë¶ÅÊ±Ç
            UI-->>User: Á¢∫Ë™ç„Ç≥„Éº„ÉâÂÖ•Âäõ„Éó„É≠„É≥„Éó„Éà
            
            User->>UI: Á¢∫Ë™ç„Ç≥„Éº„ÉâÂÖ•Âäõ
            UI->>Apollo: confirmSignUpÂÆüË°å
            Apollo->>Cognito: Á¢∫Ë™ç„Ç≥„Éº„ÉâÊ§úË®º
            
            alt Á¢∫Ë™çÊàêÂäü
                Cognito-->>Apollo: „É¶„Éº„Ç∂„ÉºÁ¢∫Ë™çÂÆå‰∫Ü
                Apollo->>AppSync: „Éó„É≠„Éï„Ç£„Éº„É´‰ΩúÊàê
                AppSync->>Profile: „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç£„Éº„É´‰øùÂ≠ò
                Profile-->>AppSync: ‰øùÂ≠òÂÆå‰∫Ü
                AppSync-->>Apollo: „Éó„É≠„Éï„Ç£„Éº„É´‰ΩúÊàêÊàêÂäü
                Apollo-->>UI: ÁôªÈå≤ÂÆå‰∫ÜÈÄöÁü•
                UI-->>User: üéâ ÁôªÈå≤ÊàêÂäüÁîªÈù¢
            else Á¢∫Ë™çÂ§±Êïó
                Cognito-->>Apollo: Á¢∫Ë™ç„Ç®„É©„Éº
                Apollo-->>UI: „Ç®„É©„ÉºË°®Á§∫
                UI-->>User: ‚ùå Á¢∫Ë™ç„Ç≥„Éº„Éâ„Ç®„É©„Éº
            end
        else „É¶„Éº„Ç∂„Éº‰ΩúÊàêÂ§±Êïó
            Cognito-->>Apollo: ‰ΩúÊàê„Ç®„É©„ÉºÔºàÈáçË§áÁ≠âÔºâ
            Apollo-->>UI: „Ç®„É©„ÉºË°®Á§∫
            UI-->>User: ‚ùå ÁôªÈå≤„Ç®„É©„Éº
        end
    else ÂÖ•ÂäõÂÄ§„ÅåÁÑ°Âäπ
        Validation-->>UI: Ê§úË®º„Ç®„É©„Éº
        UI-->>User: ‚ùå ÂÖ•Âäõ„Ç®„É©„ÉºË°®Á§∫
    end
```

### 2.2 „É≠„Ç∞„Ç§„É≥„Å®„Éà„Éº„ÇØ„É≥ÁÆ°ÁêÜ„Éï„É≠„Éº

```mermaid
stateDiagram-v2
    [*] --> Unauthenticated: „Ç¢„Éó„É™Ëµ∑Âãï
    
    Unauthenticated --> Authenticating: „É≠„Ç∞„Ç§„É≥ÂÆüË°å
    Authenticating --> Authenticated: Ë™çË®ºÊàêÂäü
    Authenticating --> Unauthenticated: Ë™çË®ºÂ§±Êïó
    
    Authenticated --> API_Call: API „É™„ÇØ„Ç®„Çπ„Éà
    API_Call --> Token_Valid: „Éà„Éº„ÇØ„É≥Ê§úË®º
    Token_Valid --> API_Success: ÊúâÂäπ
    Token_Valid --> Token_Refresh: ÊúüÈôêÂàá„Çå
    
    Token_Refresh --> Authenticated: „É™„Éï„É¨„ÉÉ„Ç∑„É•ÊàêÂäü
    Token_Refresh --> Unauthenticated: „É™„Éï„É¨„ÉÉ„Ç∑„É•Â§±Êïó
    
    API_Success --> Authenticated: „É¨„Çπ„Éù„É≥„ÇπÂèó‰ø°
    
    Authenticated --> [*]: „É≠„Ç∞„Ç¢„Ç¶„Éà
    
    note right of Token_Refresh
        Refresh Token„Çí‰ΩøÁî®„Åó„Å¶
        Êñ∞„Åó„ÅÑAccess Token„ÇíÂèñÂæó
    end note
    
    note right of API_Success
        Ë™çË®ºÊ∏à„ÅøAPI„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ
        Ê≠£Â∏∏„Å™Âá¶ÁêÜ„Éï„É≠„Éº
    end note
```

## 3. „ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†Êìç‰Ωú„Éï„É≠„Éº

### 3.1 „É´„Éº„É†‰ΩúÊàê„Éï„É≠„Éº

```mermaid
flowchart TB
    A[„É´„Éº„É†‰ΩúÊàê„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ] --> B[„É´„Éº„É†ÂêçÂÖ•Âäõ„Éï„Ç©„Éº„É†Ë°®Á§∫]
    B --> C{ÂÖ•ÂäõÂÄ§Ê§úË®º}
    
    C -->|ÁÑ°Âäπ| D[„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫]
    D --> B
    
    C -->|ÊúâÂäπ| E[createRoom MutationÂÆüË°å]
    E --> F[AppSync: Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ]
    F --> G{Ë™çË®ºÊ∏à„Åø?}
    
    G -->|No| H[401 Unauthorized]
    H --> I[„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà]
    
    G -->|Yes| J[Resolver: ÂÖ•ÂäõÂÄ§ÂÜçÊ§úË®º]
    J --> K[UUIDÁîüÊàê]
    K --> L[„Çø„Ç§„É†„Çπ„Çø„É≥„ÉóÁîüÊàê]
    L --> M[DynamoDB: PutItemÂÆüË°å]
    
    M --> N{‰øùÂ≠òÊàêÂäü?}
    N -->|No| O[500 Internal Server Error]
    O --> P[„Ç®„É©„ÉºÈÄöÁü•Ë°®Á§∫]
    
    N -->|Yes| Q[onRoomCreated SubscriptionÁô∫ÁÅ´]
    Q --> R[ÂÖ®Êé•Á∂ö„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å´ÈÄöÁü•]
    R --> S[‰ΩúÊàêËÄÖ„Å´„É´„Éº„É†ÁîªÈù¢Ë°®Á§∫]
    R --> T[‰ªñ„É¶„Éº„Ç∂„Éº„Å´„É´„Éº„É†‰∏ÄË¶ßÊõ¥Êñ∞]
    
    subgraph "Success Indicators"
        U[‚úÖ „É´„Éº„É†‰ΩúÊàêÊàêÂäü]
        V[üì° „É™„Ç¢„É´„Çø„Ç§„É†ÈÄöÁü•]
        W[üîÑ UIËá™ÂãïÊõ¥Êñ∞]
    end
    
    S --> U
    T --> V
    R --> W
```

### 3.2 „É´„Éº„É†ÂèÇÂä†„ÉªÈÄÄÂá∫„Éï„É≠„Éº

```mermaid
sequenceDiagram
    participant User as üë§ „É¶„Éº„Ç∂„Éº
    participant RoomList as üìã „É´„Éº„É†‰∏ÄË¶ß
    participant RoomView as üí¨ „É´„Éº„É†ÁîªÈù¢
    participant WebSocket as üîå WebSocketÊé•Á∂ö
    participant AppSync as ‚ö° AppSync
    participant DynamoDB as üóÑÔ∏è DynamoDB
    
    Note over User,DynamoDB: „É´„Éº„É†ÂèÇÂä†„Éï„É≠„Éº
    
    User->>RoomList: „É´„Éº„É†ÈÅ∏Êäû„Éª„ÇØ„É™„ÉÉ„ÇØ
    RoomList->>RoomView: „É´„Éº„É†ÁîªÈù¢ÈÅ∑Áßª
    RoomView->>WebSocket: WebSocketÊé•Á∂öÁ¢∫Á´ã
    WebSocket->>AppSync: Ë™çË®ºÊÉÖÂ†±‰ªò„ÅçÊé•Á∂ö
    
    AppSync->>AppSync: JWT TokenÊ§úË®º
    AppSync-->>WebSocket: Êé•Á∂öË®±ÂèØ
    
    RoomView->>AppSync: onMessagePosted SubscriptionÁôªÈå≤
    Note over AppSync: roomId: "room_001" „Åß„Éï„Ç£„É´„Çø
    AppSync-->>RoomView: SubscriptionÁ¢∫Á´ã
    
    RoomView->>AppSync: listMessages QueryÂÆüË°å
    AppSync->>DynamoDB: room-index Query
    DynamoDB-->>AppSync: „É°„ÉÉ„Çª„Éº„Ç∏Â±•Ê≠¥
    AppSync-->>RoomView: Â±•Ê≠¥Ë°®Á§∫
    
    Note over User,DynamoDB: „É´„Éº„É†ÈÄÄÂá∫„Éï„É≠„Éº
    
    User->>RoomView: „Éñ„É©„Ç¶„Ç∂„Éê„ÉÉ„ÇØ/„É´„Éº„É†ÈÄÄÂá∫
    RoomView->>WebSocket: SubscriptionËß£Èô§
    WebSocket->>AppSync: Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫Ë¶ÅÊ±Ç
    AppSync-->>WebSocket: Ëß£Èô§Á¢∫Ë™ç
    RoomView->>RoomList: „É´„Éº„É†‰∏ÄË¶ßÁîªÈù¢„Å´Êàª„Çã
```

## 4. „É°„ÉÉ„Çª„Éº„Ç∏„É≥„Ç∞„Éª„Éï„É≠„Éº

### 4.1 „É°„ÉÉ„Çª„Éº„Ç∏ÊäïÁ®ø„Éï„É≠„ÉºË©≥Á¥∞

```mermaid
flowchart TB
    subgraph "User Interface"
        A[„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•Âäõ] --> B[ÈÄÅ‰ø°„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ]
        B --> C[ÂÖ•ÂäõÂÄ§Ê§úË®º]
    end
    
    subgraph "Client Processing"
        C --> D{ÊñáÂ≠óÊï∞Âà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ}
        D -->|OK| E[Optimistic UI Update]
        D -->|NG| F[„Ç®„É©„ÉºË°®Á§∫]
        E --> G[postMessage Mutation]
    end
    
    subgraph "Network Layer"
        G --> H[GraphQL Request]
        H --> I[HTTP POST to AppSync]
        I --> J{„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂öOK?}
        J -->|NG| K[„É™„Éà„É©„Ç§Âá¶ÁêÜ]
        K --> I
    end
    
    subgraph "API Processing"
        J -->|OK| L[AppSync Endpoint]
        L --> M[JWT TokenÊ§úË®º]
        M --> N{Ë™çË®ºÊúâÂäπ?}
        N -->|NG| O[401 Unauthorized]
        N -->|OK| P[GraphQL SchemaÊ§úË®º]
        P --> Q[ResolverÂÆüË°å]
    end
    
    subgraph "Business Logic"
        Q --> R[„É°„ÉÉ„Çª„Éº„Ç∏ÂÜÖÂÆπ„Çµ„Éã„Çø„Ç§„Ç∫]
        R --> S[„É´„Éº„É†Â≠òÂú®Á¢∫Ë™ç]
        S --> T{„É´„Éº„É†ÊúâÂäπ?}
        T -->|NG| U[404 Room Not Found]
        T -->|OK| V[„É°„Çø„Éá„Éº„Çø‰ªò‰∏é]
    end
    
    subgraph "Data Persistence"
        V --> W[DynamoDB PutItem]
        W --> X{‰øùÂ≠òÊàêÂäü?}
        X -->|NG| Y[500 Database Error]
        X -->|OK| Z[‰øùÂ≠òÂÆå‰∫Ü„É¨„Çπ„Éù„É≥„Çπ]
    end
    
    subgraph "Real-time Distribution"
        Z --> AA[DynamoDB StreamsÁô∫ÁÅ´]
        AA --> BB[Subscription EventÁîüÊàê]
        BB --> CC[WebSocketÈÖç‰ø°]
        CC --> DD[ÂèÇÂä†ËÄÖÂÖ®Âì°„Å´ÈÄöÁü•]
    end
    
    subgraph "UI Update"
        DD --> EE[Optimistic UIÁ¢∫ÂÆö]
        O --> FF[Optimistic UIÂèñ„ÇäÊ∂à„Åó]
        U --> FF
        Y --> FF
    end
```

### 4.2 „É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°„ÉªË°®Á§∫„Éï„É≠„Éº

```mermaid
sequenceDiagram
    participant UserA as üë§ User A
    participant UserB as üë§ User B
    participant UIB as üñ•Ô∏è User B UI
    participant WebSocketB as üîå B's WebSocket
    participant AppSync as ‚ö° AppSync
    participant EventSystem as üì° Event System
    participant DynamoDB as üóÑÔ∏è DynamoDB
    
    Note over UserA,DynamoDB: User A „Åå„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊäïÁ®ø
    
    UserA->>AppSync: postMessage("Hello World!")
    AppSync->>DynamoDB: „É°„ÉÉ„Çª„Éº„Ç∏‰øùÂ≠ò
    DynamoDB-->>AppSync: ‰øùÂ≠òÂÆå‰∫Ü
    AppSync-->>UserA: ÊäïÁ®øÊàêÂäü„É¨„Çπ„Éù„É≥„Çπ
    
    Note over UserA,DynamoDB: „É™„Ç¢„É´„Çø„Ç§„É†ÈÖç‰ø°„Éï„É≠„Éº
    
    AppSync->>EventSystem: onMessagePosted EventÁô∫Áîü
    EventSystem->>WebSocketB: roomId‰∏ÄËá¥Á¢∫Ë™ç
    WebSocketB-->>EventSystem: Âèó‰ø°ÂØæË±°Á¢∫Ë™ç
    
    EventSystem->>UIB: Subscription DataÈÖç‰ø°
    UIB->>UIB: „É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„ÉàÊõ¥Êñ∞
    UIB->>UIB: „Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆË™øÊï¥
    UIB->>UIB: Êñ∞ÁùÄÈÄöÁü•Ë°®Á§∫
    UIB-->>UserB: üí¨ Êñ∞„Åó„ÅÑ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    
    Note over UserA,DynamoDB: „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
    
    alt WebSocketÊé•Á∂öÊñ≠
        EventSystem->>WebSocketB: ÈÖç‰ø°Ë©¶Ë°å
        WebSocketB-->>EventSystem: Êé•Á∂ö„Ç®„É©„Éº
        EventSystem->>EventSystem: ÂÜçË©¶Ë°å„Ç≠„É•„Éº„Å´ËøΩÂä†
        EventSystem->>WebSocketB: ÂÜçÊé•Á∂öÊôÇ„Å´ÈÖç‰ø°
    else „É¶„Éº„Ç∂„Éº„Ç™„Éï„É©„Ç§„É≥
        EventSystem->>EventSystem: „Ç™„Éï„É©„Ç§„É≥Ê§úÁü•
        EventSystem->>EventSystem: Êú™Ë™≠„Ç´„Ç¶„É≥„ÉàÂ¢óÂä†
        Note over EventSystem: Ê¨°Âõû„Ç™„É≥„É©„Ç§„É≥ÊôÇ„Å´ÈÄöÁü•
    end
```

## 5. „Éá„Éº„ÇøÂêåÊúü„ÉªÊï¥ÂêàÊÄß„Éï„É≠„Éº

### 5.1 Ê•ΩË¶≥ÁöÑUIÊõ¥Êñ∞„Å®ÂêåÊúü

```mermaid
stateDiagram-v2
    [*] --> UI_Idle: ÂàùÊúüÁä∂ÊÖã
    
    UI_Idle --> Optimistic_Update: „É¶„Éº„Ç∂„ÉºÊìç‰Ωú
    Optimistic_Update --> Pending_Server: „Çµ„Éº„Éê„ÉºÈÄÅ‰ø°
    
    Pending_Server --> Success_Confirmed: „Çµ„Éº„Éê„ÉºÊàêÂäü
    Pending_Server --> Error_Occurred: „Çµ„Éº„Éê„Éº„Ç®„É©„Éº
    
    Success_Confirmed --> UI_Idle: UIÁ¢∫ÂÆö
    Error_Occurred --> Rollback_UI: UIÂ∑ª„ÅçÊàª„Åó
    Rollback_UI --> UI_Idle: „Ç®„É©„ÉºË°®Á§∫
    
    Pending_Server --> Network_Error: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº
    Network_Error --> Retry_Queue: „É™„Éà„É©„Ç§„Ç≠„É•„Éº
    Retry_Queue --> Pending_Server: ÂÜçË©¶Ë°å
    Retry_Queue --> Rollback_UI: ÊúÄÂ§ßË©¶Ë°åÂõûÊï∞Âà∞ÈÅî
    
    note right of Optimistic_Update
        „É¶„Éº„Ç∂„Éº‰ΩìÈ®ìÂêë‰∏ä„ÅÆ„Åü„ÇÅ
        Âç≥Â∫ß„Å´UIÊõ¥Êñ∞
    end note
    
    note right of Retry_Queue
        ÊåáÊï∞„Éê„ÉÉ„ÇØ„Ç™„Éï„Åß
        Ëá™Âãï„É™„Éà„É©„Ç§
    end note
```

### 5.2 Á´∂ÂêàÁä∂ÊÖã„ÅÆËß£Ê±∫„Éï„É≠„Éº

```mermaid
sequenceDiagram
    participant UserA as üë§ User A
    participant UserB as üë§ User B
    participant AppSync as ‚ö° AppSync
    participant DynamoDB as üóÑÔ∏è DynamoDB
    participant ConflictResolver as üîÑ Conflict Resolver
    
    Note over UserA,ConflictResolver: ÂêåÊôÇÁ∑®ÈõÜ„Å´„Çà„ÇãÁ´∂Âêà
    
    par UserA „ÅÆÊìç‰Ωú
        UserA->>AppSync: updateRoom(id: "room_001", name: "ÈñãÁô∫„ÉÅ„Éº„É†")
        AppSync->>DynamoDB: Êù°‰ª∂‰ªò„ÅçÊõ¥Êñ∞ (version: 1)
    and UserB „ÅÆÊìç‰Ωú  
        UserB->>AppSync: updateRoom(id: "room_001", name: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàA")
        AppSync->>DynamoDB: Êù°‰ª∂‰ªò„ÅçÊõ¥Êñ∞ (version: 1)
    end
    
    DynamoDB-->>AppSync: UserA: Êõ¥Êñ∞ÊàêÂäü (version: 2)
    DynamoDB-->>AppSync: UserB: Êù°‰ª∂‰ªò„ÅçÊõ¥Êñ∞Â§±Êïó
    
    AppSync-->>UserA: ‚úÖ Êõ¥Êñ∞ÊàêÂäü
    AppSync->>ConflictResolver: UserB: Á´∂ÂêàÊ§úÁü•
    
    ConflictResolver->>DynamoDB: ÊúÄÊñ∞„Éá„Éº„ÇøÂèñÂæó
    DynamoDB-->>ConflictResolver: ÁèæÂú®„ÅÆ„Éá„Éº„Çø (version: 2)
    
    ConflictResolver-->>UserB: ‚ùå Á´∂Âêà„Ç®„É©„Éº + ÊúÄÊñ∞„Éá„Éº„Çø
    
    alt UserB „ÅÆÂØæÂøúÈÅ∏Êäû
        UserB->>AppSync: ÊúÄÊñ∞„Éá„Éº„Çø„ÅßÂÜçÁ∑®ÈõÜ
        AppSync->>DynamoDB: Êù°‰ª∂‰ªò„ÅçÊõ¥Êñ∞ (version: 2)
        DynamoDB-->>AppSync: Êõ¥Êñ∞ÊàêÂäü (version: 3)
        AppSync-->>UserB: ‚úÖ Êõ¥Êñ∞ÊàêÂäü
    else UserB „ÅÆ„Ç≠„É£„É≥„Çª„É´
        UserB->>UserB: Á∑®ÈõÜ„Ç≠„É£„É≥„Çª„É´
        Note over UserB: ÊúÄÊñ∞„Éá„Éº„Çø„ÅßÁîªÈù¢Êõ¥Êñ∞
    end
```

## 6. „Ç≠„É£„ÉÉ„Ç∑„É•„Éª„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ„Éï„É≠„Éº

### 6.1 Â§öÂ±§„Ç≠„É£„ÉÉ„Ç∑„É•Êà¶Áï•

```mermaid
flowchart LR
    subgraph "Request Flow"
        A[Client Request] --> B{Browser Cache}
        B -->|HIT| C[Browser Response]
        B -->|MISS| D{CDN Cache}
        D -->|HIT| E[CDN Response]
        D -->|MISS| F{AppSync Cache}
        F -->|HIT| G[AppSync Response]
        F -->|MISS| H{Application Cache}
        H -->|HIT| I[App Cache Response]
        H -->|MISS| J[Database Query]
    end
    
    subgraph "Cache TTL Settings"
        K[Static Assets: 1 year]
        L[Room Data: 15 minutes]
        M[Messages: 5 minutes]
        N[User Profile: 30 minutes]
    end
    
    subgraph "Cache Invalidation"
        O[Data Update Event]
        P[Cache Key Invalidation]
        Q[Selective Cache Clear]
    end
    
    C --> K
    E --> L
    G --> M
    I --> N
    
    J --> O
    O --> P
    P --> Q
```

### 6.2 Apollo Client „Ç≠„É£„ÉÉ„Ç∑„É•„Éï„É≠„Éº

```mermaid
flowchart TB
    subgraph "Apollo Client Cache"
        A[GraphQL Query] --> B{Normalized Cache}
        B -->|HIT| C[Cache Response]
        B -->|MISS| D[Network Request]
        
        D --> E[AppSync API]
        E --> F[GraphQL Response]
        F --> G[Cache Update]
        G --> H[Component Re-render]
    end
    
    subgraph "Cache Policies"
        I[cache-first: „Ç≠„É£„ÉÉ„Ç∑„É•ÂÑ™ÂÖà]
        J[cache-and-network: ‰∏°ÊñπÂÆüË°å]
        K[network-only: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆ„Åø]
        L[cache-only: „Ç≠„É£„ÉÉ„Ç∑„É•„ÅÆ„Åø]
    end
    
    subgraph "Cache Operations"
        M[writeQuery: ÊâãÂãïÊõ¥Êñ∞]
        N[updateQuery: ÈÉ®ÂàÜÊõ¥Êñ∞]
        O[refetch: Âº∑Âà∂ÂÜçÂèñÂæó]
        P[evict: „Ç≠„É£„ÉÉ„Ç∑„É•ÂâäÈô§]
    end
    
    B --> I
    D --> J
    E --> K
    C --> L
    
    G --> M
    H --> N
    A --> O
    G --> P
```

## 7. „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Éª„Éï„É≠„Éº

### 7.1 „Ç®„É©„ÉºÂàÜÈ°û„Å®Âá¶ÁêÜ„Éï„É≠„Éº

```mermaid
flowchart TB
    A[API Request] --> B{Request Validation}
    B -->|Invalid| C[400 Bad Request]
    B -->|Valid| D{Authentication}
    
    D -->|Unauthorized| E[401 Unauthorized]
    D -->|Authorized| F{Authorization}
    
    F -->|Forbidden| G[403 Forbidden]
    F -->|Allowed| H{Business Logic}
    
    H -->|Rule Violation| I[422 Unprocessable Entity]
    H -->|Valid| J{Database Operation}
    
    J -->|Not Found| K[404 Not Found]
    J -->|Conflict| L[409 Conflict]
    J -->|Database Error| M[500 Internal Server Error]
    J -->|Success| N[200 OK]
    
    subgraph "Error Handling Strategies"
        O[Client: ÂÜçË©¶Ë°å]
        P[Client: „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ]
        Q[Client: „Ç®„É©„ÉºË°®Á§∫]
        R[Server: „É≠„Ç∞Ë®òÈå≤]
        S[Server: „Ç¢„É©„Éº„Éà]
    end
    
    C --> Q
    E --> Q
    G --> Q
    I --> Q
    K --> Q
    L --> O
    M --> P
    M --> R
    M --> S
```

### 7.2 „É™„Ç¢„É´„Çø„Ç§„É†Êé•Á∂ö„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞

```mermaid
stateDiagram-v2
    [*] --> Connected: WebSocketÊé•Á∂öÊàêÂäü
    
    Connected --> Reconnecting: Êé•Á∂öÊñ≠Ê§úÁü•
    Reconnecting --> Connected: ÂÜçÊé•Á∂öÊàêÂäü
    Reconnecting --> Failed: ÂÜçÊé•Á∂öÂ§±Êïó
    
    Failed --> Backoff: ÂæÖÊ©üÊôÇÈñìË®àÁÆó
    Backoff --> Reconnecting: ÂÜçË©¶Ë°å
    
    Connected --> MessageQueue: ÈÄÅ‰ø°Â§±Êïó„É°„ÉÉ„Çª„Éº„Ç∏
    MessageQueue --> Connected: ÂÜçÊé•Á∂öÂæåÈÄÅ‰ø°
    
    Failed --> OfflineMode: ÊúÄÂ§ßË©¶Ë°åÂõûÊï∞Âà∞ÈÅî
    OfflineMode --> Reconnecting: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂæ©ÊóßÊ§úÁü•
    
    note right of Backoff
        ÊåáÊï∞„Éê„ÉÉ„ÇØ„Ç™„Éï:
        1s ‚Üí 2s ‚Üí 4s ‚Üí 8s...
        ÊúÄÂ§ß60Áßí
    end note
    
    note right of MessageQueue
        ÈÄÅ‰ø°Â§±Êïó„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏„Çí
        „Ç≠„É•„Éº„Å´‰øùÂ≠ò„Åó„ÄÅ
        ÂÜçÊé•Á∂öÊôÇ„Å´ÈÄÅ‰ø°
    end note
    
    note right of OfflineMode
        „Ç™„Éï„É©„Ç§„É≥Ë°®Á§∫
        „É≠„Éº„Ç´„É´„Éá„Éº„Çø„ÅÆ„ÅøË°®Á§∫
    end note
```

## 8. „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ„Éª„Éï„É≠„Éº

### 8.1 „É°„Éà„É™„ÇØ„ÇπÂèéÈõÜ„Éï„É≠„Éº

```mermaid
sequenceDiagram
    participant App as üì± „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥
    participant Metrics as üìä Metrics Collector
    participant CloudWatch as ‚òÅÔ∏è CloudWatch
    participant Dashboard as üìà Dashboard
    participant Alert as üö® Alert System
    
    Note over App,Alert: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„É°„Éà„É™„ÇØ„ÇπÂèéÈõÜ
    
    App->>Metrics: API Response Time: 120ms
    App->>Metrics: Cache Hit Rate: 85%
    App->>Metrics: Error Count: 2
    App->>Metrics: Active Users: 150
    
    Metrics->>CloudWatch: Batch MetricsÈÄÅ‰ø°
    CloudWatch->>CloudWatch: „Éá„Éº„ÇøÈõÜÁ¥Ñ„Éª‰øùÂ≠ò
    
    CloudWatch->>Dashboard: „É°„Éà„É™„ÇØ„ÇπÂèØË¶ñÂåñ
    Dashboard-->>Dashboard: „É™„Ç¢„É´„Çø„Ç§„É†„Ç∞„É©„ÉïÊõ¥Êñ∞
    
    CloudWatch->>Alert: ÈñæÂÄ§„ÉÅ„Çß„ÉÉ„ÇØ
    
    alt Áï∞Â∏∏ÂÄ§Ê§úÁü•
        Alert->>Alert: „Ç¢„É©„Éº„ÉàÁîüÊàê
        Alert->>Dashboard: üö® Critical AlertË°®Á§∫
        Alert->>Alert: Slack/EmailÈÄöÁü•
    else Ê≠£Â∏∏ÂÄ§
        Alert->>Dashboard: ‚úÖ Normal Status
    end
    
    Note over App,Alert: Ëá™Âãï„Çπ„Ç±„Éº„É™„É≥„Ç∞ÈÄ£Êê∫
    
    CloudWatch->>CloudWatch: „Çπ„Ç±„Éº„É™„É≥„Ç∞„É°„Éà„É™„ÇØ„ÇπË©ï‰æ°
    CloudWatch->>App: Auto ScalingÂÆüË°å
```

### 8.2 „É¶„Éº„Ç∂„Éº„Ç®„ÇØ„Çπ„Éö„É™„Ç®„É≥„ÇπÁõ£Ë¶ñ

```mermaid
flowchart TB
    subgraph "Frontend Metrics"
        A[Page Load Time] --> B[First Contentful Paint]
        B --> C[Largest Contentful Paint]
        C --> D[Cumulative Layout Shift]
        D --> E[First Input Delay]
    end
    
    subgraph "Application Metrics"
        F[GraphQL Query Time] --> G[Cache Hit Rate]
        G --> H[WebSocket Connection Status]
        H --> I[Message Delivery Latency]
    end
    
    subgraph "User Behavior Metrics"
        J[Session Duration] --> K[Message Frequency]
        K --> L[Room Participation Rate]
        L --> M[Feature Usage Patterns]
    end
    
    subgraph "Quality Metrics"
        N[Error Rate by Feature]
        O[User Satisfaction Score]
        P[Accessibility Compliance]
        Q[Mobile Responsiveness]
    end
    
    E --> F
    I --> J
    M --> N
    N --> O
    O --> P
    P --> Q
    
    subgraph "Alerting Thresholds"
        R[Load Time > 3s: Warning]
        S[Error Rate > 1%: Critical]
        T[WebSocket Disconnect > 5%: Warning]
        U[Message Delay > 1s: Critical]
    end
```

---

*„Åì„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÅØ„ÄÅ„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÂÖ®„Éá„Éº„Çø„Éï„É≠„Éº„ÇíÂåÖÊã¨ÁöÑ„Å´Ë™¨Êòé„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂêÑ„Éï„É≠„Éº„ÅØÂÆüÈöõ„ÅÆÂÆüË£Ö„Å´Âü∫„Å•„ÅÑ„Å¶„Åä„Çä„ÄÅ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂãï‰ΩúÁêÜËß£„Å®ÊúÄÈÅ©Âåñ„Å´Ê¥ªÁî®„Åß„Åç„Åæ„Åô„ÄÇ*
