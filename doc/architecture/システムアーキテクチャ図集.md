# ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³é›†

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®æ§˜ã€…ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã‚’Mermaidã‚’ä½¿ç”¨ã—ã¦è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚

## 1. å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 é«˜ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph "Users"
        U1[Web Browser]
        U2[Mobile App]
    end
    
    subgraph "CDN Layer"
        C1[CloudFront]
        C2[S3 Static Hosting]
    end
    
    subgraph "Frontend Layer"
        F1[React Application]
        F2[Vite Build]
    end
    
    subgraph "API Layer"
        A1[AWS AppSync]
        A2[GraphQL Schema]
        A3[JavaScript Resolvers]
    end
    
    subgraph "Authentication"
        AU1[Cognito User Pool]
        AU2[Cognito Identity]
    end
    
    subgraph "Data Layer"
        D1[Room Table]
        D2[Message Table]
        D3[DynamoDB Streams]
    end
    
    subgraph "Monitoring"
        M1[CloudWatch]
        M2[X-Ray Tracing]
    end
    
    U1 --> C1
    U2 --> C1
    C1 --> C2
    C1 --> F1
    F1 --> A1
    A1 --> AU1
    A1 --> A3
    A3 --> D1
    A3 --> D2
    D1 --> D3
    D2 --> D3
    A1 --> M1
    A3 --> M2
    
    style A1 fill:#ff6b6b
    style D1 fill:#4ecdc4
    style D2 fill:#4ecdc4
    style M1 fill:#ffd93d
```

### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¦‚è¦

```mermaid
flowchart TB
    subgraph "User Interaction"
        A[ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ] --> B[React Component]
        B --> C[GraphQL Client]
    end
    
    subgraph "API Processing"
        C --> D[AWS AppSync]
        D --> E[èªè¨¼ãƒã‚§ãƒƒã‚¯]
        E --> F[GraphQL Schema Validation]
        F --> G[Resolverå®Ÿè¡Œ]
    end
    
    subgraph "Data Operations"
        G --> H[DynamoDBæ“ä½œ]
        H --> I[ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ]
    end
    
    subgraph "Real-time Updates"
        H --> J[DynamoDB Streams]
        J --> K[Subscriptioné€šçŸ¥]
        K --> L[WebSocketé…ä¿¡]
    end
    
    I --> C
    L --> B
```

## 2. èªè¨¼ãƒ»èªå¯ãƒ•ãƒ­ãƒ¼

### 2.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant React as React App
    participant Cognito as Cognito User Pool
    participant AppSync as AWS AppSync
    participant DynamoDB as DynamoDB
    
    Note over User,DynamoDB: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼
    
    User->>React: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
    React->>Cognito: signup(username, password, email)
    Cognito-->>React: ç¢ºèªã‚³ãƒ¼ãƒ‰é€ä¿¡è¦æ±‚
    
    User->>React: ç¢ºèªã‚³ãƒ¼ãƒ‰å…¥åŠ›
    React->>Cognito: confirmSignUp(code)
    Cognito-->>React: ç™»éŒ²å®Œäº†
    
    Note over User,DynamoDB: ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
    
    User->>React: ãƒ­ã‚°ã‚¤ãƒ³
    React->>Cognito: signIn(username, password)
    Cognito-->>React: JWT Token (ID, Access, Refresh)
    
    React->>AppSync: GraphQL Request + Authorization Header
    AppSync->>Cognito: Tokenæ¤œè¨¼
    Cognito-->>AppSync: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± (claims)
    
    AppSync->>DynamoDB: ãƒ‡ãƒ¼ã‚¿æ“ä½œ (as authenticated user)
    DynamoDB-->>AppSync: ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    AppSync-->>React: GraphQL Response
    React-->>User: UIæ›´æ–°
```

### 2.2 ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TB
    A[API Request] --> B{Access Tokenæœ‰åŠ¹?}
    B -->|æœ‰åŠ¹| C[APIå®Ÿè¡Œ]
    B -->|ç„¡åŠ¹/æœŸé™åˆ‡ã‚Œ| D{Refresh Tokenæœ‰åŠ¹?}
    
    D -->|æœ‰åŠ¹| E[Token Refresh]
    D -->|ç„¡åŠ¹| F[å†ãƒ­ã‚°ã‚¤ãƒ³è¦æ±‚]
    
    E --> G[æ–°ã—ã„Access Tokenå–å¾—]
    G --> H[å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†å®Ÿè¡Œ]
    H --> C
    
    F --> I[ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º]
    C --> J[æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹]
```

## 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 WebSocketæ¥ç¶šã¨Subscription

```mermaid
sequenceDiagram
    participant ClientA as Client A
    participant ClientB as Client B
    participant AppSync as AppSync WebSocket
    participant EventBus as Event Distribution
    participant DynamoDB as DynamoDB
    
    Note over ClientA,DynamoDB: WebSocketæ¥ç¶šã¨Subscriptionç™»éŒ²
    
    ClientA->>AppSync: WebSocketæ¥ç¶š + JWT Token
    AppSync-->>ClientA: æ¥ç¶šç¢ºç«‹
    
    ClientA->>AppSync: Subscription: onMessagePosted(roomId: "room_001")
    AppSync-->>ClientA: Subscriptionç™»éŒ²å®Œäº†
    
    ClientB->>AppSync: WebSocketæ¥ç¶š + JWT Token  
    AppSync-->>ClientB: æ¥ç¶šç¢ºç«‹
    
    ClientB->>AppSync: Subscription: onMessagePosted(roomId: "room_001")
    AppSync-->>ClientB: Subscriptionç™»éŒ²å®Œäº†
    
    Note over ClientA,DynamoDB: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡
    
    ClientA->>AppSync: Mutation: postMessage(roomId: "room_001", text: "Hello")
    AppSync->>DynamoDB: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¿å­˜
    DynamoDB-->>AppSync: ä¿å­˜å®Œäº†
    
    AppSync->>EventBus: MessagePosted Event
    EventBus->>AppSync: Filter: roomId = "room_001"
    
    AppSync-->>ClientA: Subscription: æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    AppSync-->>ClientB: Subscription: æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```

### 3.2 ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

```mermaid
flowchart LR
    subgraph "Event Sources"
        A[createRoom Mutation]
        B[postMessage Mutation]
        C[updateRoom Mutation]
        D[deleteRoom Mutation]
    end
    
    subgraph "Event Processing"
        E[Event Trigger]
        F[Subscription Filter]
        G[Authorization Check]
    end
    
    subgraph "Event Distribution"
        H[Global Events<br/>onRoomCreated]
        I[Room-specific Events<br/>onMessagePosted]
        J[User-specific Events<br/>onRoomUpdated]
    end
    
    subgraph "Connected Clients"
        K[All Clients]
        L[Room Participants]
        M[Room Owner]
    end
    
    A --> E
    B --> E
    C --> E
    D --> E
    
    E --> F
    F --> G
    
    G --> H
    G --> I
    G --> J
    
    H --> K
    I --> L
    J --> M
```

## 4. ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 4.1 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```mermaid
flowchart TB
    subgraph "Input Processing"
        A[GraphQL Mutation] --> B[Input Validation]
        B --> C[Authentication Check]
        C --> D[Authorization Check]
    end
    
    subgraph "Business Logic"
        D --> E[Room Existence Check]
        E --> F[Message Processing]
        F --> G[Metadata Addition]
    end
    
    subgraph "Data Persistence"
        G --> H[DynamoDB PutItem]
        H --> I[Write Confirmation]
    end
    
    subgraph "Event Processing"
        I --> J[DynamoDB Streams]
        J --> K[Lambda Trigger]
        K --> L[Event Publishing]
    end
    
    subgraph "Real-time Distribution"
        L --> M[Subscription Filtering]
        M --> N[WebSocket Notification]
    end
    
    subgraph "Error Handling"
        B --> O[Validation Error]
        C --> P[Auth Error]
        D --> Q[Authorization Error]
        E --> R[Business Logic Error]
        H --> S[Database Error]
    end
```

### 4.2 è¤‡é›‘ã‚¯ã‚¨ãƒªå‡¦ç†ï¼ˆmyActiveRoomsï¼‰

```mermaid
flowchart TB
    A[myActiveRooms Query] --> B[ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ç¢ºèª]
    B --> C[Messageãƒ†ãƒ¼ãƒ–ãƒ«ã®User-Index Query]
    C --> D[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—]
    D --> E[roomIdã®é‡è¤‡é™¤å»]
    E --> F{Roomæ•°ãƒã‚§ãƒƒã‚¯}
    
    F -->|å°‘æ•°| G[å€‹åˆ¥Roomæƒ…å ±å–å¾—]
    F -->|å¤šæ•°| H[BatchGetItemä½¿ç”¨]
    
    G --> I[å„Roomã®getRoom Queryå®Ÿè¡Œ]
    H --> J[ä¸€æ‹¬Roomæƒ…å ±å–å¾—]
    
    I --> K[çµæœãƒãƒ¼ã‚¸]
    J --> K
    
    K --> L[ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ]
    
    subgraph "Optimization Options"
        M[Pipeline Resolver]
        N[Caching Layer]
        O[DataLoader Pattern]
    end
```

## 5. ç›£è¦–ãƒ»ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### 5.1 ç›£è¦–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph "Application Layer"
        A1[AppSync APIs]
        A2[DynamoDB]
        A3[Cognito]
        A4[Lambda Functions]
    end
    
    subgraph "Monitoring Services"
        M1[CloudWatch]
        M2[X-Ray Tracing]
        M3[CloudWatch Logs]
        M4[Custom Metrics]
    end
    
    subgraph "Alerting & Notification"
        AL1[SNS Notifications]
        AL2[Slack Integration]
        AL3[PagerDuty]
    end
    
    subgraph "Dashboards & Analytics"
        D1[Grafana]
        D2[QuickSight]
        D3[Kibana/OpenSearch]
    end
    
    A1 --> M1
    A2 --> M1
    A3 --> M1
    A4 --> M2
    
    M1 --> AL1
    M4 --> AL2
    
    M3 --> D1
    M1 --> D2
    
    style M1 fill:#ff6b6b
    style AL1 fill:#4ecdc4
    style D1 fill:#ffd93d
```

### 5.2 ãƒ­ã‚°é›†ç´„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```mermaid
flowchart LR
    subgraph "Log Sources"
        A[AppSync Logs]
        B[DynamoDB Logs]
        C[Cognito Logs]
        D[Application Logs]
    end
    
    subgraph "Log Processing"
        E[CloudWatch Logs]
        F[Log Filters]
        G[Log Streams]
    end
    
    subgraph "Log Storage & Analysis"
        H[S3 Archive]
        I[OpenSearch]
        J[Kinesis Data Streams]
    end
    
    subgraph "Alerting & Dashboards"
        K[CloudWatch Alarms]
        L[Custom Dashboards]
        M[Log Analysis]
    end
    
    A --> E
    B --> E
    C --> E
    D --> E
    
    E --> F
    F --> G
    
    G --> H
    G --> I
    G --> J
    
    I --> K
    I --> L
    I --> M
```

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 6.1 å¤šå±¤é˜²å¾¡ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph "Network Security"
        A[CloudFront WAF] --> B[DDoS Protection]
        B --> C[IP Allowlisting]
        C --> D[Rate Limiting]
    end
    
    subgraph "Application Security"
        D --> E[HTTPS/TLS 1.3]
        E --> F[JWT Token Validation]
        F --> G[Input Sanitization]
        G --> H[GraphQL Query Depth Limiting]
    end
    
    subgraph "Authentication & Authorization"
        H --> I[Cognito User Pool]
        I --> J[Multi-Factor Authentication]
        J --> K[Role-Based Access Control]
        K --> L[Resource-Level Permissions]
    end
    
    subgraph "Data Security"
        L --> M[Encryption at Rest]
        M --> N[Encryption in Transit]
        N --> O[Field-Level Encryption]
        O --> P[Audit Logging]
    end
```

### 6.2 ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant Client as ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    participant CloudFront as CloudFront
    participant AppSync as AppSync
    participant KMS as AWS KMS
    participant DynamoDB as DynamoDB
    
    Note over Client,DynamoDB: ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ã®å…¨ãƒ•ãƒ­ãƒ¼
    
    Client->>CloudFront: HTTPS Request (TLS 1.3)
    CloudFront->>AppSync: Encrypted in Transit
    
    AppSync->>KMS: ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼è¦æ±‚
    KMS-->>AppSync: æš—å·åŒ–ã‚­ãƒ¼æä¾›
    
    AppSync->>DynamoDB: æš—å·åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ä¿å­˜
    Note over DynamoDB: Server-side Encryption
    
    DynamoDB-->>AppSync: æš—å·åŒ–ã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    AppSync->>KMS: å¾©å·åŒ–ã‚­ãƒ¼è¦æ±‚
    KMS-->>AppSync: å¾©å·åŒ–ã‚­ãƒ¼æä¾›
    
    AppSync-->>CloudFront: æš—å·åŒ–ã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    CloudFront-->>Client: HTTPS Response (TLS 1.3)
```

## 8. ç½å®³å¾©æ—§ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 8.1 ãƒãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³æ§‹æˆ

```mermaid
flowchart TB
    subgraph "Global Services"
        G1[Route 53]
        G2[CloudFront]
        G3[S3 Cross-Region Backup]
    end
    
    subgraph "Primary Region (us-east-1)"
        P1[AppSync Primary]
        P2[DynamoDB Primary]
        P3[Cognito Primary]
    end
    
    subgraph "Secondary Region (us-west-2)"
        S1[AppSync Secondary]
        S2[DynamoDB Secondary]
        S3[Cognito Secondary]
    end
    
    G1 --> P1
    G1 --> S1
    
    P2 --> S2
    P3 --> S3
    
    P2 --> G3
    S2 --> G3
    
    style P1 fill:#e1f5fe
    style S1 fill:#f3e5f5
    style G1 fill:#e8f5e8
    style G3 fill:#fff3e0
```

### 8.2 è‡ªå‹•ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ä»•çµ„ã¿

```mermaid
flowchart TB
    A[Health Check] --> B{Primary Region OK?}
    B -->|æ­£å¸¸| C[é€šå¸¸é‹ç”¨ç¶™ç¶š]
    B -->|ç•°å¸¸| D[Health Checkå¤±æ•—]
    
    D --> E[Route 53 DNSåˆ‡ã‚Šæ›¿ãˆ]
    E --> F[Secondary Regionã¸ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯èª˜å°]
    F --> G[DynamoDB Global Tablesã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–]
    G --> H[Cognito Secondary Poolä½¿ç”¨]
    
    H --> I[ã‚µãƒ¼ãƒ“ã‚¹å¾©æ—§ç¢ºèª]
    I --> J{Primary Regionå¾©æ—§?}
    J -->|å¾©æ—§| K[ãƒ•ã‚§ã‚¤ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ]
    J -->|æœªå¾©æ—§| L[Secondary Regionç¶™ç¶šé‹ç”¨]
    
    K --> M[ãƒ‡ãƒ¼ã‚¿åŒæœŸç¢ºèª]
    M --> N[Primary Regionã¸åˆ‡ã‚Šæˆ»ã—]
    N --> C
```

## 9. é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 9.1 CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```mermaid
flowchart TD
    A["feature/new-api"] --> B["development"]
    B --> C["é–‹ç™ºç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤"]
    C --> D["çµ±åˆãƒ†ã‚¹ãƒˆ"]
    D --> E["main"]
    E --> F["stagingç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤"]
    F --> G["E2Eãƒ†ã‚¹ãƒˆ"]
    G --> H["ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"]
    H --> I["release"]
    I --> J["productionç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤"]
    J --> K["æœ¬ç•ªç›£è¦–é–‹å§‹"]
    K --> L["mainï¼ˆãƒªãƒªãƒ¼ã‚¹å®Œäº†ï¼‰"]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style E fill:#bfb,stroke:#333,stroke-width:2px
    style I fill:#fbb,stroke:#333,stroke-width:2px
    style L fill:#bfb,stroke:#333,stroke-width:2px
```

### 9.2 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart LR
    subgraph "Source Control"
        A[GitHub Repository] --> B[Pull Request]
        B --> C[Code Review]
        C --> D[Merge to Main]
    end
    
    subgraph "CI Pipeline"
        D --> E[GitHub Actions]
        E --> F[Linting & Testing]
        F --> G[Build Application]
        G --> H[Infrastructure as Code]
    end
    
    subgraph "CD Pipeline"
        H --> I[Deploy to Staging]
        I --> J[Integration Tests]
        J --> K[Security Scans]
        K --> L[Deploy to Production]
    end
    
    subgraph "Monitoring"
        L --> M[Deployment Monitoring]
        M --> N[Health Checks]
        N --> O[Rollback if Needed]
    end
```

## ğŸ“ ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£æœ€é©åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Terraformæœ€é©åŒ–å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```mermaid
flowchart TB
    subgraph "Infrastructure as Code (æœ€é©åŒ–æ¸ˆã¿)"
        subgraph "è¨­å®šç®¡ç†"
            MAIN[main.tf<br/>ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š]
            VARS[variables.tf<br/>å¤‰æ•°å®šç¾©ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
            LOCALS[locals.tf<br/>è¨ˆç®—å€¤ãƒ»å¤‰æ›]
            OUTPUTS[outputs.tf<br/>å‡ºåŠ›å€¤å®šç¾©]
            TFVARS[terraform.tfvars.example<br/>è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ]
        end
        
        subgraph "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"
            IAM[iam.tf<br/>æ¨©é™åˆ¶å¾¡ãƒ»æœ€å°æ¨©é™]
        end
        
        subgraph "ã‚µãƒ¼ãƒ“ã‚¹åˆ¥è¨­å®š"
            DDB[dynamodb.tf<br/>DynamoDBæœ€é©åŒ–]
            COGNITO[cognito_optimized.tf<br/>èªè¨¼å¼·åŒ–]
            APPSYNC[appsync_optimized.tf<br/>GraphQL APIæœ€é©åŒ–]
            LAMBDA[lambda_optimized.tf<br/>Lambdaé–¢æ•°æœ€é©åŒ–]
            RESOLVERS[resolvers_optimized.tf<br/>ãƒªã‚¾ãƒ«ãƒãƒ¼è¨­å®š]
        end
        
        subgraph "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
            TEMPLATES[resolver_templates/<br/>ãƒªã‚¾ãƒ«ãƒãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ]
        end
    end
    
    MAIN --> VARS
    VARS --> LOCALS
    LOCALS --> OUTPUTS
    
    IAM --> DDB
    IAM --> COGNITO
    IAM --> APPSYNC
    IAM --> LAMBDA
    
    APPSYNC --> RESOLVERS
    RESOLVERS --> TEMPLATES
```

### ã‚¤ãƒ³ãƒ•ãƒ©æœ€é©åŒ–ã®åŠ¹æœ

```mermaid
flowchart LR
    subgraph "Before (æœ€é©åŒ–å‰)"
        B1[å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«æ··åœ¨]
        B2[åŸºæœ¬è¨­å®šã®ã¿]
        B3[æ‰‹å‹•è¨­å®šå¤šæ•°]
        B4[æœ€å°é™ã®ç›£è¦–]
    end
    
    subgraph "After (æœ€é©åŒ–å¾Œ)"
        A1[è²¬å‹™åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²]
        A2[åŒ…æ‹¬çš„è¨­å®šãƒ»ç›£è¦–]
        A3[è‡ªå‹•åŒ–ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
        A4[CloudWatchçµ±åˆ]
    end
    
    B1 --> A1
    B2 --> A2  
    B3 --> A3
    B4 --> A4
    
    A1 --> BENEFIT1[ä¿å®ˆæ€§å‘ä¸Š]
    A2 --> BENEFIT2[é‹ç”¨åŠ¹ç‡åŒ–]
    A3 --> BENEFIT3[å“è³ªä¿è¨¼]
    A4 --> BENEFIT4[ç›£è¦–å¼·åŒ–]
```

### ç’°å¢ƒåˆ¥è¨­å®šç®¡ç†

```mermaid
flowchart TB
    subgraph "Development Environment"
        DEV_CONFIG[terraform.tfvars<br/>environment = "dev"]
        DEV_FEATURES[
            - API Keyèªè¨¼ä½µç”¨
            - çŸ­æœŸãƒ­ã‚°ä¿æŒ
            - æœ€å°ãƒªã‚½ãƒ¼ã‚¹
            - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
        ]
    end
    
    subgraph "Production Environment"
        PROD_CONFIG[terraform.tfvars<br/>environment = "prod"]
        PROD_FEATURES[
            - Cognitoèªè¨¼ã®ã¿
            - é•·æœŸãƒ­ã‚°ä¿æŒ
            - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãƒªã‚½ãƒ¼ã‚¹
            - CloudWatchå¼·åŒ–
            - X-Rayæœ‰åŠ¹
        ]
    end
    
    subgraph "Shared Infrastructure"
        SHARED[
            - DynamoDBè¨­è¨ˆ
            - IAMæœ€å°æ¨©é™
            - æš—å·åŒ–è¨­å®š
            - ã‚¿ã‚°æˆ¦ç•¥
        ]
    end
    
    DEV_CONFIG --> SHARED
    PROD_CONFIG --> SHARED
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤"
        subgraph "èªè¨¼ãƒ»èªå¯"
            COGNITO_SEC[Cognitoå¼·åŒ–<br/>- MFAå¯¾å¿œ<br/>- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼<br/>- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§]
            IAM_SEC[IAMæœ€å°æ¨©é™<br/>- ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ­ãƒ¼ãƒ«<br/>- æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹<br/>- ãƒªã‚½ãƒ¼ã‚¹é™å®š]
        end
        
        subgraph "ãƒ‡ãƒ¼ã‚¿ä¿è­·"
            ENCRYPT[æš—å·åŒ–<br/>- DynamoDBæš—å·åŒ–<br/>- Lambdaæš—å·åŒ–<br/>- ãƒ­ã‚°æš—å·åŒ–]
            BACKUP[ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—<br/>- Point-in-Time Recovery<br/>- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—<br/>- ç’°å¢ƒåˆ¥è¨­å®š]
        end
        
        subgraph "ç›£è¦–ãƒ»è¿½è·¡"
            CLOUDWATCH[CloudWatch<br/>- ãƒ­ã‚°ç›£è¦–<br/>- ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®š<br/>- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
            XRAY[X-Ray<br/>- åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°<br/>- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–<br/>- ã‚¨ãƒ©ãƒ¼è¿½è·¡]
        end
    end
    
    COGNITO_SEC --> IAM_SEC
    IAM_SEC --> ENCRYPT
    ENCRYPT --> BACKUP
    BACKUP --> CLOUDWATCH
    CLOUDWATCH --> XRAY
```

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’åŒ…æ‹¬çš„ã«å›³è§£ã—ã¦ã„ã¾ã™ã€‚Terraformæœ€é©åŒ–ã«ã‚ˆã‚Šã€ä¿å®ˆæ€§ãƒ»å®‰å…¨æ€§ãƒ»é‹ç”¨åŠ¹ç‡ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã—ãŸã€‚*
